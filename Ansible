
Ansible notes

# Automating Docker and Terraform Deployment with Ansible
Configure AWS CLI to connect to AWS account
Connect with an AWS user

UI access through password

CLI Access through Access key ID and Secret Access key

aws configure
AWS Access Key ID : (which is given in the IAM users section)

AWS Secret Access Key : (which is given in the IAM users section)

Default region name : (set your preferred region, for ex: ap-south-1)

Default output format : (ser your preferred output format, for ex: json)

Configuration is automatically stored in your home directory under /.aws
Part 1: Ansible and Docker
Overview
Create an AWS EC2 Instance with Terraform

Configure Inventory file to connect to AWS EC2 Instance

Install Docker and docker-compose

Copy docker-compose file to the server

Start docker containers

Create an AWS EC2 Instance with Terraform
You can access the Terraform file here.

Create your own "terraform.tfvars" file and include the following:

COPY
vpc_cidr_block = "10.0.0.0/16"
subnet_1_cidr_block = "10.0.0.0/24"
avail_zone = "your preferred az" (example: "ap-south-1a")
env_prefix = "dev"
instance_type = "t2.micro"
ssh_key = "your public ssh key" (like "/home/sonali-rajput/.ssh/id_rsa.pub")
my_ip = "your IP"
ssh_private_key = "private ssh key" (like "/home/sonali-rajput/.ssh/id_rsa")
terraform init (for initializing)

terraform apply

Your EC2 instance will be created and you'll get the server-ip in your console output.

Configure Inventory file to connect to AWS EC2 Instance
You can find the code here.

Create a "hosts" file and save the server-ip address as:

[docker_server]
<your_server_ip> ansible_ssh_private_key_file=~/.ssh/id_rsa ansible_user=ec2-user
Now, We will write the Ansible Playbook for installing the necessary tools.

Install Docker and docker-compose
Create a deploy-docker.yml
---
- name: Insatll Docker, Docker-compose
  hosts: docker_server
  become: yes
  tasks:
    - name: Install Docker
      yum:
        name: docker
        update_cache: true
        state: present
    - name: Install docker-compose
      get_url:
        url: https://github.com/docker/compose/releases/download/1.27.4/docker-compose-Linux-{{lookup('pipe', 'uname -m')}}
        dest: /usr/local/bin/docker-compose
        mode: +x
    - name: Start docker daemon
      systemd:
        name: docker
        state: started
    - name: Install docker python module
      pip:
        name: 
          - docker
          - docker-compose
